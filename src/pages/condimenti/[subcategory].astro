---
/**
 * Dynamiczny route dla podkategorii Condimenti
 * /condimenti/pesto, /condimenti/aceto, etc.
 */

import Layout from '../../layouts/Layout.astro';
import VerticalHeader from '../../components/VerticalHeader.astro';
import HorizontalHeader from '../../components/HorizontalHeader.astro';
import ProducerCard from '../../components/ProducerCard.astro';
import { getCategoryBySlug } from '../../lib/constants/categories';
import { getProducersByCategory } from '../../lib/api/producers';
import styles from '../../../styles/CategoryPage.module.css';

const VALID_SUBCATEGORIES = ['pesto', 'aceto', 'altre'];

// getStaticPaths() - generuje wszystkie podkategorie condimenti
export async function getStaticPaths() {
  return VALID_SUBCATEGORIES.map(subcategory => ({
    params: { subcategory }
  }));
}

// Pobierz parametr z URL
const { subcategory } = Astro.params;

// Walidacja subcategory
if (!VALID_SUBCATEGORIES.includes(subcategory!)) {
  return Astro.redirect('/404');
}

// Zbuduj pełny slug (condimenti-pesto, condimenti-aceto, etc.)
const fullSlug = `condimenti-${subcategory}`;

// Pobierz dane kategorii
const categoryData = getCategoryBySlug(fullSlug);

if (!categoryData) {
  return Astro.redirect('/404');
}

// Pobierz producentów
const producers = await getProducersByCategory(fullSlug);

// Metadata dla SEO
const title = `${categoryData.label} - ${categoryData.title} Italiani | Piazza Virtuale`;
const description = `Scopri i ${categoryData.title.toLowerCase()} italiani che vendono online direttamente ai consumatori.`;
---

<Layout title={title} description={description}>
  {/* Vertical Header */}
  <VerticalHeader />

  {/* Main Content Area */}
  <div class="main-content-area">
    {/* Horizontal Header */}
    <HorizontalHeader />

    {/* Main Content */}
    <main class="main-content">
      <section class={styles.categorySection}>
        <div class={styles.shopsGrid}>
          {producers.length > 0 ? (
            producers.map(producer => (
              <ProducerCard
                categoryName={producer.category.name}
                producerName={producer.name}
                producerNameAlt={producer.name_alt}
                regionName={producer.region}
                logoPath={producer.logo}
                shopUrl={producer.shop_url}
              />
            ))
          ) : (
            <p class={styles.nessunTrovato}>
              Nessun produttore trovato in questa categoria.
            </p>
          )}
        </div>
      </section>
    </main>
  </div>
</Layout>
